<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>オセロ（AI対戦・難易度選択・勝敗表示）</title>
<style>
  body{font-family:sans-serif;text-align:center;background:#0b0f14;color:#fff;margin:0;padding:0}
  .top{display:flex;gap:12px;justify-content:center;align-items:center;flex-wrap:wrap;margin:12px 8px}
  .board{display:grid;grid-template-columns:repeat(8,50px);grid-template-rows:repeat(8,50px);gap:2px;justify-content:center;margin:8px auto 20px}
  .cell{width:50px;height:50px;background:green;display:flex;align-items:center;justify-content:center;cursor:pointer}
  .disc{width:40px;height:40px;border-radius:50%}
  .black{background:black}
  .white{background:white}
  .hint{width:10px;height:10px;border-radius:50%;background:rgba(255,255,255,0.5)}
  select,button{font:inherit;padding:6px 10px;border-radius:8px;border:0;background:#111827;color:#e5e7eb}
  button{cursor:pointer}
</style>
</head>
<body>
<h1>オセロ（AI対戦・難易度選択・勝敗表示）</h1>
<div class="top">
  <div>難易度:
    <select id="level">
      <option value="easy">かんたん</option>
      <option value="normal" selected>ふつう</option>
      <option value="hard">つよい</option>
    </select>
  </div>
  <button id="restart">リスタート</button>
</div>
<div id="status"></div>
<div class="board" id="board"></div>
<script>
const SIZE=8,EMPTY=0,BLACK=1,WHITE=-1,DIRS=[[1,0],[-1,0],[0,1],[0,-1],[1,1],[1,-1],[-1,1],[-1,-1]]
let board=[],player=BLACK;const levelEl=document.getElementById('level');
const WEIGHTS=[[120,-20,20,5,5,20,-20,120],[-20,-40,-5,-5,-5,-5,-40,-20],[20,-5,15,3,3,15,-5,20],[5,-5,3,3,3,3,-5,5],[5,-5,3,3,3,3,-5,5],[20,-5,15,3,3,15,-5,20],[-20,-40,-5,-5,-5,-5,-40,-20],[120,-20,20,5,5,20,-20,120]]
function init(){board=Array.from({length:SIZE},()=>Array(SIZE).fill(EMPTY));const m=SIZE/2;board[m-1][m-1]=WHITE;board[m][m]=WHITE;board[m-1][m]=BLACK;board[m][m-1]=BLACK;player=BLACK;render()}
function inb(r,c){return r>=0&&r<SIZE&&c>=0&&c<SIZE}
function flips(r,c,p){if(board[r][c]!==EMPTY)return[];let res=[];for(const[dr,dc]of DIRS){let rr=r+dr,cc=c+dc,tmp=[];while(inb(rr,cc)&&board[rr][cc]===-p){tmp.push([rr,cc]);rr+=dr;cc+=dc}if(tmp.length&&inb(rr,cc)&&board[rr][cc]===p)res=res.concat(tmp)}return res}
function moves(p){let ms=[];for(let r=0;r<SIZE;r++)for(let c=0;c<SIZE;c++){let f=flips(r,c,p);if(f.length)ms.push({r,c,f})}return ms}
function applyTo(b,mv,p){const nb=b.map(r=>r.slice());nb[mv.r][mv.c]=p;mv.f.forEach(([r,c])=>nb[r][c]=p);return nb}
function apply(mv,p){board=applyTo(board,mv,p)}
function countStones(b){let black=0,white=0;for(let r=0;r<SIZE;r++)for(let c=0;c<SIZE;c++){if(b[r][c]===BLACK)black++; else if(b[r][c]===WHITE)white++;}return {black,white};}
function mobility(b,p){let count=0;for(let r=0;r<SIZE;r++)for(let c=0;c<SIZE;c++){if(b[r][c]!==EMPTY)continue;for(const[dr,dc]of DIRS){let rr=r+dr,cc=c+dc,seen=false;while(rr>=0&&rr<SIZE&&cc>=0&&cc<SIZE&&b[rr][cc]===-p){seen=true;rr+=dr;cc+=dc}if(seen&&rr>=0&&rr<SIZE&&cc>=0&&cc<SIZE&&b[rr][cc]===p){count++;break}}}return count}
function evalMove(b,mv,p){let v=WEIGHTS[mv.r][mv.c]*(p===BLACK?1:-1)+mv.f.length*3;const rp=mv.r,cp=mv.c;const cadj=(rp===0&&cp===1)||(rp===1&&cp===0)||(rp===1&&cp===1)||(rp===0&&cp===6)||(rp===1&&cp===7)||(rp===1&&cp===6)||(rp===6&&cp===0)||(rp===7&&cp===1)||(rp===6&&cp===1)||(rp===6&&cp===7)||(rp===7&&cp===6)||(rp===6&&cp===6);if(cadj)v-=35;return v}
function bestMoveEasy(){const ms=moves(WHITE);return ms.length?ms[Math.floor(Math.random()*ms.length)]:null}
function bestMoveNormal(){const ms=moves(WHITE);let best=null,bval=-1e9;for(const mv of ms){const nb=applyTo(board,mv,WHITE);const base=evalMove(board,mv,WHITE);const opp=mobility(nb,BLACK);const val=base-2*opp;if(val>bval){bval=val;best=mv}}return best}
function bestMoveHard(){const ms=moves(WHITE);let best=null,bval=-1e9;for(const mv of ms){const b1=applyTo(board,mv,WHITE);const base=evalMove(board,mv,WHITE)-2*mobility(b1,BLACK);const replies=movesOn(b1,BLACK);let worst=1e9;if(replies.length===0){worst=0}else{for(const rmv of replies){const b2=applyTo(b1,rmv,BLACK);const reply=evalMove(b1,rmv,BLACK)-2*mobility(b2,WHITE);if(reply<worst)worst=reply}}const val=base - 0.5*worst;if(val>bval){bval=val;best=mv}}return best}
function movesOn(b,p){let ms=[];for(let r=0;r<SIZE;r++)for(let c=0;c<SIZE;c++){if(b[r][c]!==EMPTY)continue;let res=[];for(const[dr,dc]of DIRS){let rr=r+dr,cc=c+dc,tmp=[];while(rr>=0&&rr<SIZE&&cc>=0&&cc<SIZE&&b[rr][cc]===-p){tmp.push([rr,cc]);rr+=dr;cc+=dc}if(tmp.length&&rr>=0&&rr<SIZE&&cc>=0&&cc<SIZE&&b[rr][cc]===p)res=res.concat(tmp)}if(res.length)ms.push({r,c,f:res})}return ms}
function render(){const bEl=document.getElementById('board');bEl.innerHTML='';let ms=moves(player),mset=new Set(ms.map(m=>m.r+','+m.c));for(let r=0;r<SIZE;r++){for(let c=0;c<SIZE;c++){let cell=document.createElement('div');cell.className='cell';if(board[r][c]!==EMPTY){let d=document.createElement('div');d.className='disc '+(board[r][c]===BLACK?'black':'white');cell.appendChild(d)}else if(mset.has(r+','+c)&&player===BLACK){let h=document.createElement('div');h.className='hint';cell.appendChild(h)}cell.onclick=()=>{if(player===BLACK){let mv=ms.find(m=>m.r===r&&m.c===c);if(mv){apply(mv,player);player=-player;render();setTimeout(aiMove,250)}}};bEl.appendChild(cell)}}
  if(ms.length===0){
    let oppMoves = moves(-player);
    if(oppMoves.length===0){
      const {black,white} = countStones(board);
      let result = black>white ? '黒の勝ち!' : white>black ? '白の勝ち!' : '引き分け';
      document.getElementById('status').textContent = `終局｜黒:${black} 白:${white} → ${result}`;
      return;
    } else {
      player=-player;
      if(player===WHITE) setTimeout(aiMove,200);
    }
  }
  document.getElementById('status').textContent=player===BLACK?`黒の手番｜難易度: ${label(levelEl.value)}`:`白(AI)の手番｜難易度: ${label(levelEl.value)}`;
}
function aiMove(){let mv=null;const lv=levelEl.value;if(lv==='easy')mv=bestMoveEasy();else if(lv==='normal')mv=bestMoveNormal();else mv=bestMoveHard();if(mv){apply(mv,WHITE)}player=BLACK;render()}
function label(v){return v==='easy'?'かんたん':(v==='normal'?'ふつう':'つよい')}
levelEl.addEventListener('change',()=>{document.getElementById('status').textContent=`難易度: ${label(levelEl.value)}`})
document.getElementById('restart').onclick=()=>init()
init()
</script>
</body>
</html>
